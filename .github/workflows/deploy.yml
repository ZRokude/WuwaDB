# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: .NET

on:
  push:
    branches: [ "Dev" ]
  pull_request:
    branches: [ "Dev" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x
    - name: Restore dependencies
      run: dotnet restore
    - name: Build
      run: dotnet build --no-restore
    - name: Test
      run: dotnet test --no-build --verbosity normal
    - name: Deploy to VPS
      env: 
        SSH_PRIVATE_KEY : ${{ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAAMS39WNzQqJF+ISimHgt2fPD5hJI61fF4K6CnVBXoxZ1157sXeGgz47MY99eOGrc5sg1K7ndDsb6gZTp/FiQfna1Ik/7qpbLtmlax9iFdgha/5ACYVBcmDVcuS6lE6fl3LQKmqLPOVIHhCs9b3Nqo9bDkOF8HgvBkitofcR2MXH404kPEnht3t1Y4hzDB+hTrLHF3DptcBs3+Q1YZTeincl6vEHuj2HbeRGixmGD65E0pBDY6ExtwYYj+ZeUK3BP/4bbeToEbopg4a0oQN/s24xtFR+rJBAsffsUkr6z/4mazqu/FaFsrw6KfPj0wa9YQLsaWIwhZjTWI6vX4kzAIdcjluLpHlWpJMTcgwa3V2n1TKnL7KlZwa+R1cu10+WiBN7Ws6ySCVnV2rGQT1zLbY6ZG0a2kQsjNpKEJ4O68BTpfo6aCLnV7Q0jAK+rQz57YIWJ9dmsvmzgohktxgxHfzH+tla/SYsMT5hwAFQ7YG95gVYL0LF9jz/IfdYBjr1viM4Qi1h2UEZCrnhqNCEYmMVL5WiqY7mRGEtTemD0fpukg7wnRe9hWx2P+CUjs9IDpwrFCbuF+3k81xaYiIZURiE4+28U015Mbi4NaVQOKVzwINAREma4jObji/oG5apuFiFIQz6x1Uz4CFgDlvO+wrrmfXXMcodyDZfbLUSUZKB}}
        SSH__HOST: ${{212.132.101.39}}
        SSH_USER: ${{ZRokude89@gmail.com}}
      run: | 
        echo  "$SSH_PRIVATE_KEY" > private_key
        chmod 600 private_key

        scp -i private_key -r ./publish/*$SSH_USER@$SSH_HOST: /publish

          cd /publish

          dotnet ef database update --project WuwaDB.DBAccess --startup-project WuwaDB

        rm private_key

          
